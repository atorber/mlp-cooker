# åº”ç”¨æ¨¡æ¿å¼€å‘æ–‡æ¡£

## ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [å¿«é€Ÿå¼€å§‹ï¼šæ·»åŠ æ–°åº”ç”¨](#å¿«é€Ÿå¼€å§‹æ·»åŠ æ–°åº”ç”¨)
- [ç›®å½•ç»“æž„](#ç›®å½•ç»“æž„)
- [æ–‡ä»¶è¯´æ˜Ž](#æ–‡ä»¶è¯´æ˜Ž)
- [æ”¯æŒçš„æ“ä½œç±»åž‹](#æ”¯æŒçš„æ“ä½œç±»åž‹)
- [å®Œæ•´ç¤ºä¾‹](#å®Œæ•´ç¤ºä¾‹)
- [æœ€ä½³å®žè·µ](#æœ€ä½³å®žè·µ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [å‘åŽå…¼å®¹](#å‘åŽå…¼å®¹)

## æ¦‚è¿°

åº”ç”¨æ¨¡æ¿é‡‡ç”¨ç›®å½•ç»“æž„è¿›è¡Œç»„ç»‡ï¼Œæ¯ä¸ªåº”ç”¨å¯¹åº”ä¸€ä¸ªç›®å½•ï¼Œç›®å½•åå³ä¸ºåº”ç”¨IDï¼ˆappIdï¼‰ã€‚æ¯ä¸ªæ“ä½œæ¨¡æ¿å•ç‹¬å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç»“æž„æ›´åŠ æ¸…æ™°å’Œæ˜“äºŽç»´æŠ¤ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- ðŸ“ æ¯ä¸ªåº”ç”¨ä¸€ä¸ªç›®å½•ï¼Œä¾¿äºŽç»„ç»‡å’Œç®¡ç†
- ðŸ“„ æ¯ä¸ªæ“ä½œæ¨¡æ¿ç‹¬ç«‹æ–‡ä»¶ï¼Œä¾¿äºŽç»´æŠ¤å’Œæ‰©å±•
- ðŸŽ¯ å…ƒæ•°æ®å’Œæ¨¡æ¿åˆ†ç¦»ï¼Œç»“æž„æ¸…æ™°
- ðŸ”§ æ”¯æŒå¤šç§æ“ä½œç±»åž‹ï¼šéƒ¨ç½²æŽ¨ç†æœåŠ¡ã€åˆ›å»ºè®­ç»ƒä»»åŠ¡ã€åˆ›å»ºä»»åŠ¡ã€éƒ¨ç½²å·¥å…·
- âš™ï¸ çµæ´»çš„å‘½ä»¤æ–‡ä»¶é…ç½®ï¼Œæ”¯æŒæ¯ä¸ªæ“ä½œç‹¬ç«‹é…ç½®

## å¿«é€Ÿå¼€å§‹ï¼šæ·»åŠ æ–°åº”ç”¨

### æ­¥éª¤ 1ï¼šåˆ›å»ºåº”ç”¨ç›®å½•

åœ¨ `backend-nodejs/data/app/` ç›®å½•ä¸‹åˆ›å»ºåº”ç”¨ç›®å½•ï¼Œç›®å½•åå³ä¸ºåº”ç”¨IDï¼š

```bash
mkdir -p backend-nodejs/data/app/my-new-app
```

**å‘½åè§„èŒƒ**ï¼š
- ä½¿ç”¨å°å†™å­—æ¯å’Œè¿žå­—ç¬¦ï¼ˆkebab-caseï¼‰ï¼Œå¦‚ï¼š`my-new-app`
- å»ºè®®ä½¿ç”¨æè¿°æ€§åç§°ï¼Œå¦‚ï¼š`model-bert-base`ã€`task-data-processing`
- é¿å…ä½¿ç”¨ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦

### æ­¥éª¤ 2ï¼šåˆ›å»º app.json æ–‡ä»¶

åœ¨åº”ç”¨ç›®å½•ä¸­åˆ›å»º `app.json` æ–‡ä»¶ï¼ŒåŒ…å«åº”ç”¨çš„åŸºæœ¬ä¿¡æ¯å’Œæ“ä½œé…ç½®ï¼š

```json
{
  "name": "æˆ‘çš„æ–°åº”ç”¨",
  "description": "åº”ç”¨çš„è¯¦ç»†æè¿°ï¼Œè¯´æ˜Žåº”ç”¨çš„åŠŸèƒ½å’Œç”¨é€”",
  "type": "deployment",
  "categoryType": "model",
  "category": "æ¨¡åž‹",
  "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],
  "actions": [
    {
      "type": "deploy",
      "label": "éƒ¨ç½²æŽ¨ç†æœåŠ¡",
      "description": "éƒ¨ç½²æŽ¨ç†æœåŠ¡åˆ°å¹³å°",
      "templateKey": "deploy"
    }
  ]
}
```

**å¿…å¡«å­—æ®µè¯´æ˜Ž**ï¼š
- `name`ï¼šåº”ç”¨åç§°ï¼Œæ˜¾ç¤ºåœ¨å‰ç«¯ç•Œé¢ä¸Š
- `description`ï¼šåº”ç”¨æè¿°ï¼Œè¯´æ˜Žåº”ç”¨çš„åŠŸèƒ½å’Œç”¨é€”
- `type`ï¼šåº”ç”¨ç±»åž‹ï¼Œå¯é€‰å€¼ï¼š`deployment`ã€`training`ã€`batch-job`
- `categoryType`ï¼šåˆ†ç±»ç±»åž‹ï¼Œå¯é€‰å€¼ï¼š`model`ã€`task`ã€`tool`
- `category`ï¼šåˆ†ç±»åç§°ï¼Œå¦‚ï¼š"æ¨¡åž‹"ã€"ä»»åŠ¡"ã€"å·¥å…·"
- `tags`ï¼šæ ‡ç­¾æ•°ç»„ï¼Œç”¨äºŽåˆ†ç±»å’Œæœç´¢
- `actions`ï¼šæ“ä½œé…ç½®æ•°ç»„ï¼Œå®šä¹‰è¯¥åº”ç”¨æ”¯æŒçš„æ“ä½œç±»åž‹

**å¯é€‰å­—æ®µ**ï¼š
- `icon`ï¼šå›¾æ ‡URL
- `thumbnail`ï¼šç¼©ç•¥å›¾URL

### æ­¥éª¤ 3ï¼šåˆ›å»ºæ“ä½œæ¨¡æ¿æ–‡ä»¶

æ ¹æ® `actions` ä¸­å®šä¹‰çš„æ“ä½œç±»åž‹ï¼Œåˆ›å»ºå¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœ `actions` ä¸­åŒ…å« `type: "deploy"`ï¼Œåˆ™éœ€è¦åˆ›å»º `deploy.json` æ–‡ä»¶ï¼š

**deploy.json**ï¼ˆéƒ¨ç½²æŽ¨ç†æœåŠ¡æ¨¡æ¿ï¼‰ï¼š
```json
{
  "accelerators": {
    "baidu.com/a800": 8,
    "baidu.com/h20": 1
  },
  "taskParams": {
    "name": "my-service",
    "replicas": 1,
    "description": "æˆ‘çš„æœåŠ¡æè¿°",
    "resourceSpec": {
      "cpus": 2,
      "memory": 4,
      "acceleratorCount": 1,
      "acceleratorType": "baidu.com/h20_141g_cgpu"
    }
  }
}
```

**æ”¯æŒçš„æ¨¡æ¿æ–‡ä»¶å**ï¼š
- `deploy.json` - éƒ¨ç½²æŽ¨ç†æœåŠ¡
- `train.json` - åˆ›å»ºè®­ç»ƒä»»åŠ¡
- `create-job.json` - åˆ›å»ºä»»åŠ¡
- `deploy-tool.json` - éƒ¨ç½²å·¥å…·

### æ­¥éª¤ 4ï¼šåˆ›å»ºå¯åŠ¨å‘½ä»¤æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

å¦‚æžœéœ€è¦è‡ªå®šä¹‰å¯åŠ¨å‘½ä»¤ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªæ“ä½œåˆ›å»ºå¯¹åº”çš„å‘½ä»¤æ–‡ä»¶ï¼š

```bash
# åˆ›å»ºéƒ¨ç½²æ“ä½œçš„å¯åŠ¨å‘½ä»¤æ–‡ä»¶
cat > deploy.command.sh << 'EOF'
python app.py --host 0.0.0.0 --port 8000
EOF
```

**å‘½ä»¤æ–‡ä»¶å‘½åè§„èŒƒ**ï¼š
- `{action-type}.command.sh` - ç‰¹å®šæ“ä½œçš„å‘½ä»¤æ–‡ä»¶ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
- `command.sh` - å…¨å±€å‘½ä»¤æ–‡ä»¶ï¼ˆåº”ç”¨åˆ°æ‰€æœ‰æ“ä½œï¼‰

**æ³¨æ„**ï¼š
- å‘½ä»¤æ–‡ä»¶å†…å®¹ä¼šè‡ªåŠ¨è¦†ç›–æ¨¡æ¿ JSON æ–‡ä»¶ä¸­çš„ `command` å­—æ®µ
- æ”¯æŒå˜é‡æ›¿æ¢ï¼ˆå¦‚ `${variable_name}`ï¼‰

### æ­¥éª¤ 5ï¼šæµ‹è¯•åº”ç”¨

1. **é‡å¯åŽç«¯æœåŠ¡**ï¼šç¡®ä¿æ–°çš„åº”ç”¨æ–‡ä»¶è¢«åŠ è½½
2. **è®¿é—®åº”ç”¨åˆ—è¡¨æŽ¥å£**ï¼š`GET /api/apps`
3. **æ£€æŸ¥åº”ç”¨æ˜¯å¦æ­£ç¡®åŠ è½½**ï¼šç¡®è®¤æ–°åº”ç”¨å‡ºçŽ°åœ¨åˆ—è¡¨ä¸­
4. **æµ‹è¯•æ“ä½œåŠŸèƒ½**ï¼šåœ¨å‰ç«¯ç•Œé¢æµ‹è¯•åº”ç”¨çš„å„ä¸ªæ“ä½œ

### å®Œæ•´ç¤ºä¾‹ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„ä»»åŠ¡åº”ç”¨

å‡è®¾è¦åˆ›å»ºä¸€ä¸ª"æ•°æ®å¤„ç†ä»»åŠ¡"åº”ç”¨ï¼š

```bash
# æ­¥éª¤ 1: åˆ›å»ºç›®å½•
mkdir -p backend-nodejs/data/app/task-data-processing

# æ­¥éª¤ 2: åˆ›å»º app.json
cat > backend-nodejs/data/app/task-data-processing/app.json << 'EOF'
{
  "name": "æ•°æ®å¤„ç†ä»»åŠ¡",
  "description": "ç”¨äºŽå¤„ç†æ•°æ®é›†çš„ä»»åŠ¡æ¨¡æ¿",
  "type": "batch-job",
  "categoryType": "task",
  "category": "æ•°æ®å¤„ç†",
  "tags": ["æ•°æ®å¤„ç†", "æ‰¹å¤„ç†"],
  "actions": [
    {
      "type": "create-job",
      "label": "åˆ›å»ºä»»åŠ¡",
      "description": "åˆ›å»ºæ•°æ®å¤„ç†ä»»åŠ¡",
      "templateKey": "create-job"
    }
  ]
}
EOF

# æ­¥éª¤ 3: åˆ›å»ºæ“ä½œæ¨¡æ¿æ–‡ä»¶
cat > backend-nodejs/data/app/task-data-processing/create-job.json << 'EOF'
{
  "taskParams": {
    "name": "data-processing-job",
    "jobType": "PyTorchJob",
    "command": "python process_data.py",
    "jobSpec": {
      "replicas": 1,
      "image": "registry.baidubce.com/aihc-aiak/aiak-megatron:ubuntu20.04-cu11.8-torch1.14.0-py38_v1.2.7.12_release",
      "resources": [],
      "envs": [
        {
          "name": "DATA_PATH",
          "value": "/mnt/data"
        }
      ],
      "enableRDMA": false
    }
  }
}
EOF

# æ­¥éª¤ 4: åˆ›å»ºå¯åŠ¨å‘½ä»¤æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
cat > backend-nodejs/data/app/task-data-processing/create-job.command.sh << 'EOF'
python process_data.py --input ${input_path} --output ${output_path}
EOF
```

## ç›®å½•ç»“æž„

```
data/app/
â”œâ”€â”€ {app-id}/              # åº”ç”¨ç›®å½•ï¼ˆä»¥åº”ç”¨IDå‘½åï¼‰
â”‚   â”œâ”€â”€ app.json          # åº”ç”¨ä¸»é…ç½®æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰- åªåŒ…å«å…ƒæ•°æ®å’Œ actions é…ç½®
â”‚   â”œâ”€â”€ deploy.json       # éƒ¨ç½²æŽ¨ç†æœåŠ¡æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ train.json        # åˆ›å»ºè®­ç»ƒä»»åŠ¡æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ create-job.json   # åˆ›å»ºä»»åŠ¡æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ deploy-tool.json  # éƒ¨ç½²å·¥å…·æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ deploy.command.sh      # éƒ¨ç½²æ“ä½œçš„å¯åŠ¨å‘½ä»¤ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ train.command.sh       # è®­ç»ƒæ“ä½œçš„å¯åŠ¨å‘½ä»¤ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ create-job.command.sh  # åˆ›å»ºä»»åŠ¡çš„å¯åŠ¨å‘½ä»¤ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ deploy-tool.command.sh # éƒ¨ç½²å·¥å…·çš„å¯åŠ¨å‘½ä»¤ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ command.sh        # å…¨å±€å¯åŠ¨å‘½ä»¤ï¼ˆå¯é€‰ï¼Œå‘åŽå…¼å®¹ï¼‰
â”‚   â””â”€â”€ thumbnail.*       # ç¼©ç•¥å›¾æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œæ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼ï¼‰
â”œâ”€â”€ ...
â””â”€â”€ README.md             # æœ¬è¯´æ˜Žæ–‡æ¡£
```

## æ–‡ä»¶è¯´æ˜Ž

### app.jsonï¼ˆå¿…éœ€ï¼‰

åº”ç”¨ä¸»é…ç½®æ–‡ä»¶ï¼ŒåªåŒ…å«åº”ç”¨çš„å…ƒæ•°æ®å’Œ actions é…ç½®ï¼Œä¸åŒ…å«å…·ä½“çš„æ¨¡æ¿æ•°æ®ï¼š

```json
{
  "name": "åº”ç”¨åç§°",
  "description": "åº”ç”¨æè¿°",
  "type": "deployment" | "training" | "batch-job",
  "categoryType": "model" | "task" | "tool",
  "category": "åˆ†ç±»åç§°",
  "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],
  "icon": "å›¾æ ‡URL",
  "thumbnail": "ç¼©ç•¥å›¾URL",
  "actions": [
    {
      "type": "deploy" | "train" | "create-job" | "deploy-tool",
      "label": "æ“ä½œæ ‡ç­¾",
      "description": "æ“ä½œæè¿°",
      "templateKey": "deploy" | "train" | "create-job" | "deploy-tool"
    }
  ]
}
```

**å­—æ®µè¯´æ˜Ž**ï¼š

| å­—æ®µ | ç±»åž‹ | å¿…å¡« | è¯´æ˜Ž |
|------|------|------|------|
| `name` | string | æ˜¯ | åº”ç”¨åç§°ï¼Œæ˜¾ç¤ºåœ¨å‰ç«¯ç•Œé¢ |
| `description` | string | æ˜¯ | åº”ç”¨æè¿°ï¼Œè¯´æ˜Žåº”ç”¨çš„åŠŸèƒ½å’Œç”¨é€” |
| `type` | string | æ˜¯ | åº”ç”¨ç±»åž‹ï¼š`deployment`ï¼ˆæœåŠ¡éƒ¨ç½²ï¼‰ã€`training`ï¼ˆè®­ç»ƒï¼‰ã€`batch-job`ï¼ˆæ‰¹é‡ä»»åŠ¡ï¼‰ |
| `categoryType` | string | æ˜¯ | åˆ†ç±»ç±»åž‹ï¼š`model`ï¼ˆæ¨¡åž‹ï¼‰ã€`task`ï¼ˆä»»åŠ¡ï¼‰ã€`tool`ï¼ˆå·¥å…·ï¼‰ |
| `category` | string | å¦ | åˆ†ç±»åç§°ï¼Œå¦‚ï¼š"æ¨¡åž‹è®­ç»ƒ"ã€"æ•°æ®å¤„ç†" |
| `tags` | string[] | å¦ | æ ‡ç­¾æ•°ç»„ï¼Œç”¨äºŽåˆ†ç±»å’Œæœç´¢ |
| `icon` | string | å¦ | å›¾æ ‡URL |
| `thumbnail` | string | å¦ | ç¼©ç•¥å›¾URL |
| `actions` | object[] | æ˜¯ | æ“ä½œé…ç½®æ•°ç»„ï¼Œå®šä¹‰è¯¥åº”ç”¨æ”¯æŒçš„æ“ä½œç±»åž‹ |

**actions å­—æ®µè¯´æ˜Ž**ï¼š

| å­—æ®µ | ç±»åž‹ | å¿…å¡« | è¯´æ˜Ž |
|------|------|------|------|
| `type` | string | æ˜¯ | æ“ä½œç±»åž‹ï¼š`deploy`ã€`train`ã€`create-job`ã€`deploy-tool` |
| `label` | string | æ˜¯ | æ“ä½œæ ‡ç­¾ï¼Œæ˜¾ç¤ºåœ¨æŒ‰é’®ä¸Š |
| `description` | string | å¦ | æ“ä½œæè¿° |
| `templateKey` | string | æ˜¯ | æ¨¡æ¿é”®ï¼Œé€šå¸¸ä¸Ž `type` ç›¸åŒ |

**æ³¨æ„**ï¼š
- `app.json` ä¸­ä¸å†åŒ…å« `templates` å­—æ®µï¼ˆå‘åŽå…¼å®¹ï¼šå¦‚æžœå­˜åœ¨ï¼Œä»èƒ½æ­£å¸¸åŠ è½½ï¼‰
- `actions` æ•°ç»„å®šä¹‰äº†è¯¥åº”ç”¨æ”¯æŒçš„æ“ä½œç±»åž‹
- `type` å¿…é¡»ä¸Žæ“ä½œæ¨¡æ¿æ–‡ä»¶åå¯¹åº”ï¼ˆ`deploy` â†’ `deploy.json`ï¼Œ`train` â†’ `train.json` ç­‰ï¼‰

### æ“ä½œæ¨¡æ¿æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

æ¯ä¸ªæ“ä½œå¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„ JSON æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸Žæ“ä½œç±»åž‹å¯¹åº”ï¼š

#### deploy.json - éƒ¨ç½²æŽ¨ç†æœåŠ¡æ¨¡æ¿

```json
{
  "accelerators": {
    "baidu.com/a800": 8,
    "baidu.com/h20": 1
  },
  "taskParams": {
    "name": "service-name",
    "replicas": 1,
    "description": "æœåŠ¡æè¿°",
    "resourceSpec": {
      "cpus": 2,
      "memory": 4,
      "acceleratorCount": 1,
      "acceleratorType": "baidu.com/h20_141g_cgpu"
    }
  }
}
```

**å­—æ®µè¯´æ˜Ž**ï¼š
- `accelerators`ï¼šæ”¯æŒçš„åŠ é€Ÿå¡ç±»åž‹åŠæ•°é‡ï¼Œç”¨äºŽå‰ç«¯æ˜¾ç¤º
- `taskParams`ï¼šæœåŠ¡éƒ¨ç½²çš„å‚æ•°é…ç½®

#### train.json - åˆ›å»ºè®­ç»ƒä»»åŠ¡æ¨¡æ¿

```json
{
  "command": "python train.py",
  "accelerators": {
    "baidu.com/a800": 8
  },
  "taskParams": {
    "name": "training-job-name",
    "jobType": "PyTorchJob",
    "command": "python train.py",
    "jobSpec": {
      "replicas": 1,
      "image": "registry.baidubce.com/aihc-aiak/aiak-megatron:...",
      "resources": [],
      "envs": [
        {
          "name": "NCCL_DEBUG",
          "value": "INFO"
        }
      ],
      "enableRDMA": true
    }
  }
}
```

**å­—æ®µè¯´æ˜Ž**ï¼š
- `command`ï¼šå¯åŠ¨å‘½ä»¤ï¼ˆä¼šè¢«å‘½ä»¤æ–‡ä»¶è¦†ç›–ï¼‰
- `accelerators`ï¼šæ”¯æŒçš„åŠ é€Ÿå¡ç±»åž‹åŠæ•°é‡
- `taskParams`ï¼šè®­ç»ƒä»»åŠ¡çš„å‚æ•°é…ç½®

#### create-job.json - åˆ›å»ºä»»åŠ¡æ¨¡æ¿

```json
{
  "taskParams": {
    "name": "job-name",
    "jobType": "PyTorchJob",
    "command": "",
    "jobSpec": {
      "replicas": 1,
      "image": "registry.baidubce.com/aihc-aiak/aiak-megatron:...",
      "resources": [],
      "envs": [],
      "enableRDMA": false
    }
  }
}
```

**å­—æ®µè¯´æ˜Ž**ï¼š
- `taskParams`ï¼šä»»åŠ¡çš„å‚æ•°é…ç½®
- `command`ï¼šå¦‚æžœä¸ºç©ºï¼Œå°†ä»Žå‘½ä»¤æ–‡ä»¶ä¸­è¯»å–

#### deploy-tool.json - éƒ¨ç½²å·¥å…·æ¨¡æ¿

```json
{
  "command": "python tool.py",
  "taskParams": {
    "name": "tool-service-name",
    "replicas": 1,
    "description": "å·¥å…·æœåŠ¡æè¿°",
    "resourceSpec": {
      "acceleratorCount": 1,
      "acceleratorType": "baidu.com/h20_141g_cgpu"
    }
  }
}
```

**å­—æ®µè¯´æ˜Ž**ï¼š
- `command`ï¼šå¯åŠ¨å‘½ä»¤ï¼ˆä¼šè¢«å‘½ä»¤æ–‡ä»¶è¦†ç›–ï¼‰
- `taskParams`ï¼šå·¥å…·æœåŠ¡çš„å‚æ•°é…ç½®

### å¯åŠ¨å‘½ä»¤æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

æ¯ä¸ªæ“ä½œå¯ä»¥æœ‰è‡ªå·±çš„å¯åŠ¨å‘½ä»¤æ–‡ä»¶ï¼Œæ–‡ä»¶åæ ¼å¼ä¸ºï¼š`{action-type}.command.sh`

**ä¼˜å…ˆçº§**ï¼š
1. `{action-type}.command.sh`ï¼ˆç‰¹å®šæ“ä½œçš„å‘½ä»¤æ–‡ä»¶ï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼‰
2. `command.sh`ï¼ˆå…¨å±€å‘½ä»¤æ–‡ä»¶ï¼Œå‘åŽå…¼å®¹ï¼‰

**ç¤ºä¾‹**ï¼š
- `deploy.command.sh` - éƒ¨ç½²æŽ¨ç†æœåŠ¡çš„å¯åŠ¨å‘½ä»¤
- `train.command.sh` - åˆ›å»ºè®­ç»ƒä»»åŠ¡çš„å¯åŠ¨å‘½ä»¤
- `create-job.command.sh` - åˆ›å»ºä»»åŠ¡çš„å¯åŠ¨å‘½ä»¤
- `deploy-tool.command.sh` - éƒ¨ç½²å·¥å…·çš„å¯åŠ¨å‘½ä»¤
- `command.sh` - å…¨å±€å¯åŠ¨å‘½ä»¤ï¼ˆå¦‚æžœå­˜åœ¨ï¼Œä¼šåº”ç”¨åˆ°æ‰€æœ‰æ“ä½œï¼‰

**æ³¨æ„**ï¼š
- å‘½ä»¤æ–‡ä»¶å†…å®¹ä¼šè‡ªåŠ¨è¦†ç›–å¯¹åº”æ¨¡æ¿ JSON æ–‡ä»¶ä¸­çš„ `command` å­—æ®µ
- æ”¯æŒå˜é‡æ›¿æ¢ï¼ˆå¦‚ `${variable_name}`ï¼‰
- å‘½ä»¤æ–‡ä»¶å†…å®¹ä¼šè¢«è¯»å–å¹¶åŽ»é™¤é¦–å°¾ç©ºç™½

### thumbnail.*ï¼ˆå¯é€‰ï¼‰

åº”ç”¨ç¼©ç•¥å›¾æ–‡ä»¶ï¼Œæ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼ï¼ˆå¦‚ `.png`ã€`.jpg`ã€`.jpeg`ã€`.webp` ç­‰ï¼‰ã€‚

## æ”¯æŒçš„æ“ä½œç±»åž‹

ç³»ç»Ÿæ”¯æŒä»¥ä¸‹å››ç§æ“ä½œç±»åž‹ï¼š

1. **deploy** - éƒ¨ç½²æŽ¨ç†æœåŠ¡
   - æ¨¡æ¿æ–‡ä»¶ï¼š`deploy.json`
   - å‘½ä»¤æ–‡ä»¶ï¼š`deploy.command.sh`
   - ç”¨é€”ï¼šéƒ¨ç½²åœ¨çº¿æŽ¨ç†æœåŠ¡
   
2. **train** - åˆ›å»ºè®­ç»ƒä»»åŠ¡
   - æ¨¡æ¿æ–‡ä»¶ï¼š`train.json`
   - å‘½ä»¤æ–‡ä»¶ï¼š`train.command.sh`
   - ç”¨é€”ï¼šåˆ›å»ºæ¨¡åž‹è®­ç»ƒä»»åŠ¡
   
3. **create-job** - åˆ›å»ºä»»åŠ¡
   - æ¨¡æ¿æ–‡ä»¶ï¼š`create-job.json`
   - å‘½ä»¤æ–‡ä»¶ï¼š`create-job.command.sh`
   - ç”¨é€”ï¼šåˆ›å»ºæ‰¹å¤„ç†ä»»åŠ¡ï¼ˆå¦‚æ•°æ®å¤„ç†ã€æ•°æ®ä¸‹è½½ç­‰ï¼‰
   
4. **deploy-tool** - éƒ¨ç½²å·¥å…·
   - æ¨¡æ¿æ–‡ä»¶ï¼š`deploy-tool.json`
   - å‘½ä»¤æ–‡ä»¶ï¼š`deploy-tool.command.sh`
   - ç”¨é€”ï¼šéƒ¨ç½²å·¥å…·ç±»æœåŠ¡

## å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šå•æ“ä½œåº”ç”¨ï¼ˆåˆ›å»ºä»»åŠ¡ï¼‰

**ç›®å½•ç»“æž„**ï¼š
```
task-hf-dataset-download/
â”œâ”€â”€ app.json
â”œâ”€â”€ create-job.json
â””â”€â”€ create-job.command.sh
```

**app.json**:
```json
{
  "name": "HuggingFace æ•°æ®é›†ä¸‹è½½",
  "description": "ä»Ž Hugging Face ä¸‹è½½æ•°æ®é›†åˆ°å­˜å‚¨å·",
  "type": "batch-job",
  "categoryType": "task",
  "category": "æ•°æ®å¤„ç†",
  "tags": ["HuggingFace", "Dataset", "Download"],
  "actions": [
    {
      "type": "create-job",
      "label": "åˆ›å»ºä»»åŠ¡",
      "description": "åˆ›å»ºæ•°æ®é›†ä¸‹è½½ä»»åŠ¡",
      "templateKey": "create-job"
    }
  ]
}
```

**create-job.json**:
```json
{
  "taskParams": {
    "name": "hf-dataset-download",
    "jobType": "PyTorchJob",
    "command": "",
    "jobSpec": {
      "replicas": 1,
      "image": "registry.baidubce.com/aihc-aiak/aiak-megatron:ubuntu20.04-cu11.8-torch1.14.0-py38_v1.2.7.12_release",
      "resources": [],
      "envs": [
        {
          "name": "HF_ENDPOINT",
          "value": "https://hf-mirror.com"
        }
      ],
      "enableRDMA": false
    },
    "dataset_name": "BAAI/bge-large-zh-v1.5",
    "save_path": "/mnt/pvc/datasets/bge-large-zh-v1.5"
  }
}
```

**create-job.command.sh**:
```bash
pip install -U huggingface_hub && python -c "from huggingface_hub import snapshot_download; snapshot_download(repo_id='${dataset_name}', local_dir='${save_path}', repo_type='dataset', ignore_patterns=['*.msgpack', '*.bin', '*.h5'])"
```

### ç¤ºä¾‹ 2ï¼šå¤šæ“ä½œåº”ç”¨ï¼ˆéƒ¨ç½²+è®­ç»ƒï¼‰

**ç›®å½•ç»“æž„**ï¼š
```
model-qwen3-3b/
â”œâ”€â”€ app.json
â”œâ”€â”€ deploy.json
â”œâ”€â”€ train.json
â”œâ”€â”€ deploy.command.sh (å¯é€‰)
â””â”€â”€ train.command.sh (å¯é€‰)
```

**app.json**:
```json
{
  "name": "Qwen3-3B",
  "description": "Qwen3-3Bæ¨¡åž‹",
  "type": "training",
  "categoryType": "model",
  "category": "æ¨¡åž‹è®­ç»ƒ",
  "tags": ["è®­ç»ƒ", "PyTorch", "Qwen3-3B"],
  "actions": [
    {
      "type": "deploy",
      "label": "éƒ¨ç½²æŽ¨ç†æœåŠ¡",
      "description": "éƒ¨ç½²æœåŠ¡",
      "templateKey": "deploy"
    },
    {
      "type": "train",
      "label": "åˆ›å»ºè®­ç»ƒä»»åŠ¡",
      "description": "åˆ›å»ºè®­ç»ƒä»»åŠ¡",
      "templateKey": "train"
    }
  ]
}
```

**deploy.json**:
```json
{
  "accelerators": {
    "baidu.com/h20": 1
  },
  "taskParams": {
    "name": "qwen3-3b-service",
    "replicas": 1,
    "description": "Qwen3-3BæœåŠ¡",
    "resourceSpec": {
      "cpus": 2,
      "memory": 4,
      "acceleratorCount": 1,
      "acceleratorType": "baidu.com/h20_141g_cgpu"
    }
  }
}
```

**train.json**:
```json
{
  "command": "python train.py",
  "accelerators": {
    "baidu.com/a800": 8
  },
  "taskParams": {
    "name": "qwen3-3b-training",
    "jobType": "PyTorchJob",
    "command": "python train.py",
    "jobSpec": {
      "replicas": 1,
      "image": "registry.baidubce.com/aihc-aiak/aiak-megatron:ubuntu20.04-cu11.8-torch1.14.0-py38_v1.2.7.12_release",
      "resources": [],
      "envs": [],
      "enableRDMA": false
    }
  }
}
```

## æœ€ä½³å®žè·µ

### 1. å‘½åè§„èŒƒ

- **åº”ç”¨ç›®å½•å**ï¼šä½¿ç”¨å°å†™å­—æ¯å’Œè¿žå­—ç¬¦ï¼ˆkebab-caseï¼‰ï¼Œå¦‚ï¼š`model-bert-base`ã€`task-data-processing`
- **æ–‡ä»¶å**ï¼šä¸¥æ ¼æŒ‰ç…§è§„èŒƒå‘½åï¼Œå¦‚ï¼š`deploy.json`ã€`train.json`ã€`create-job.json`
- **å˜é‡å**ï¼šä½¿ç”¨é©¼å³°å‘½åæ³•ï¼ˆcamelCaseï¼‰ï¼Œå¦‚ï¼š`datasetName`ã€`savePath`

### 2. æ–‡ä»¶ç»„ç»‡

- **å¿…å¡«æ–‡ä»¶**ï¼š`app.json` æ˜¯å¿…éœ€çš„ï¼Œå¿…é¡»åˆ›å»º
- **å¯é€‰æ–‡ä»¶**ï¼šæ ¹æ®åº”ç”¨æ”¯æŒçš„æ“ä½œç±»åž‹ï¼Œåˆ›å»ºå¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶å’Œå‘½ä»¤æ–‡ä»¶
- **ä¸è¦å†—ä½™**ï¼šå¦‚æžœæŸä¸ªæ“ä½œä¸éœ€è¦è‡ªå®šä¹‰å‘½ä»¤ï¼Œå¯ä»¥çœç•¥å¯¹åº”çš„ `.command.sh` æ–‡ä»¶

### 3. JSON æ ¼å¼

- **æ ¼å¼åŒ–**ï¼šä½¿ç”¨ 2 ä¸ªç©ºæ ¼ç¼©è¿›ï¼Œä¿æŒæ ¼å¼ä¸€è‡´
- **å­—æ®µé¡ºåº**ï¼šå»ºè®®æŒ‰ç…§é€»è¾‘é¡ºåºæŽ’åˆ—å­—æ®µï¼ˆå¦‚ï¼šå…ƒæ•°æ® â†’ actions â†’ templatesï¼‰
- **æ³¨é‡Š**ï¼šJSON ä¸æ”¯æŒæ³¨é‡Šï¼Œå¦‚æœ‰éœ€è¦ï¼Œä½¿ç”¨ `_comment` å­—æ®µæˆ–åœ¨æ–‡æ¡£ä¸­è¯´æ˜Ž

### 4. å‘½ä»¤æ–‡ä»¶

- **ä½¿ç”¨å˜é‡**ï¼šåœ¨å‘½ä»¤ä¸­ä½¿ç”¨ `${variable_name}` è¿›è¡Œå˜é‡æ›¿æ¢
- **å¤šè¡Œå‘½ä»¤**ï¼šæ”¯æŒå¤šè¡Œå‘½ä»¤ï¼Œæ¯è¡Œä¼šè‡ªåŠ¨æ‰§è¡Œ
- **é”™è¯¯å¤„ç†**ï¼šåœ¨å‘½ä»¤ä¸­æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†é€»è¾‘

### 5. æµ‹è¯•å’ŒéªŒè¯

- **è¯­æ³•æ£€æŸ¥**ï¼šåˆ›å»ºæ–‡ä»¶åŽï¼Œä½¿ç”¨ JSON éªŒè¯å·¥å…·æ£€æŸ¥ JSON æ ¼å¼
- **åŠŸèƒ½æµ‹è¯•**ï¼šé‡å¯åŽç«¯æœåŠ¡åŽï¼Œæµ‹è¯•åº”ç”¨æ˜¯å¦èƒ½æ­£å¸¸åŠ è½½å’Œä½¿ç”¨
- **æ—¥å¿—æŸ¥çœ‹**ï¼šå¦‚æžœå‡ºçŽ°é—®é¢˜ï¼ŒæŸ¥çœ‹åŽç«¯æ—¥å¿—èŽ·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ·»åŠ å¤šä¸ªæ“ä½œï¼Ÿ

åœ¨ `app.json` çš„ `actions` æ•°ç»„ä¸­æ·»åŠ å¤šä¸ªæ“ä½œé…ç½®ï¼Œå¹¶åˆ›å»ºå¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶ï¼š

```json
{
  "actions": [
    {
      "type": "deploy",
      "label": "éƒ¨ç½²æŽ¨ç†æœåŠ¡",
      "templateKey": "deploy"
    },
    {
      "type": "train",
      "label": "åˆ›å»ºè®­ç»ƒä»»åŠ¡",
      "templateKey": "train"
    }
  ]
}
```

ç„¶åŽåˆ›å»º `deploy.json` å’Œ `train.json` æ–‡ä»¶ã€‚

### Q2: å¦‚ä½•é…ç½®åŠ é€Ÿå¡ä¿¡æ¯ï¼Ÿ

åœ¨æ¨¡æ¿æ–‡ä»¶çš„ `accelerators` å­—æ®µä¸­é…ç½®ï¼š

```json
{
  "accelerators": {
    "baidu.com/a800": 8,
    "baidu.com/h20": 1
  }
}
```

è¿™ä¸ªä¿¡æ¯ç”¨äºŽå‰ç«¯æ˜¾ç¤ºï¼Œä¸å½±å“å®žé™…çš„èµ„æºåˆ†é…ã€‚

### Q3: å‘½ä»¤æ–‡ä»¶å¦‚ä½•è¦†ç›–æ¨¡æ¿ä¸­çš„ commandï¼Ÿ

ç³»ç»Ÿä¼šæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§åŠ è½½å‘½ä»¤ï¼š
1. `{action-type}.command.sh`ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
2. `command.sh`ï¼ˆå…¨å±€å‘½ä»¤ï¼‰
3. æ¨¡æ¿ JSON æ–‡ä»¶ä¸­çš„ `command` å­—æ®µ

### Q4: å¦‚ä½•æ·»åŠ çŽ¯å¢ƒå˜é‡ï¼Ÿ

åœ¨ `taskParams.jobSpec.envs` æ•°ç»„ä¸­æ·»åŠ ï¼š

```json
{
  "taskParams": {
    "jobSpec": {
      "envs": [
        {
          "name": "ENV_NAME",
          "value": "env_value"
        }
      ]
    }
  }
}
```

### Q5: åº”ç”¨æ²¡æœ‰æ˜¾ç¤ºåœ¨å‰ç«¯ï¼Ÿ

æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. `app.json` æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
2. `actions` æ•°ç»„æ˜¯å¦æ­£ç¡®é…ç½®
3. å¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶æ˜¯å¦å­˜åœ¨
4. åŽç«¯æœåŠ¡æ˜¯å¦å·²é‡å¯
5. æŸ¥çœ‹åŽç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

## å‘åŽå…¼å®¹

ç³»ç»ŸåŒæ—¶æ”¯æŒæ—§æ ¼å¼ä»¥ä¿æŒå‘åŽå…¼å®¹ï¼š

### æ—§æ ¼å¼1ï¼šå•æ–‡ä»¶æ–¹å¼

```
data/app/
â”œâ”€â”€ {app-id}.json         # æ—§æ ¼å¼ï¼šå•æ–‡ä»¶æ–¹å¼
â””â”€â”€ {app-id}.sh           # æ—§æ ¼å¼ï¼šå¯åŠ¨å‘½ä»¤æ–‡ä»¶
```

### æ—§æ ¼å¼2ï¼šç›®å½•+app.jsonï¼ˆåŒ…å« templatesï¼‰

```
data/app/
â”œâ”€â”€ {app-id}/
â”‚   â”œâ”€â”€ app.json          # åŒ…å« templates å­—æ®µ
â”‚   â””â”€â”€ command.sh
```

**ä¼˜å…ˆçº§**ï¼š
1. æœ€æ–°ç»“æž„ï¼ˆç›®å½•+åˆ†ç¦»æ¨¡æ¿æ–‡ä»¶ï¼‰ï¼š`{app-id}/app.json` + `{action}.json` + `{action}.command.sh`
2. æ–°ç»“æž„ï¼ˆç›®å½•+app.jsonåŒ…å«templatesï¼‰ï¼š`{app-id}/app.json`ï¼ˆåŒ…å« `templates`ï¼‰+ `command.sh`
3. æ—§ç»“æž„ï¼ˆå•æ–‡ä»¶æ–¹å¼ï¼‰ï¼š`{app-id}.json` + `{app-id}.sh`

ç³»ç»Ÿä¼šä¼˜å…ˆå°è¯•åŠ è½½æœ€æ–°ç»“æž„ï¼Œå¦‚æžœä¸å­˜åœ¨åˆ™ä¾æ¬¡å›žé€€åˆ°æ—§ç»“æž„ã€‚

## ä¼˜åŠ¿

æ–°ç»“æž„ç›¸æ¯”æ—§ç»“æž„å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **æ›´å¥½çš„ç»„ç»‡ç»“æž„**ï¼šæ¯ä¸ªåº”ç”¨å’Œæ¯ä¸ªæ“ä½œçš„æ–‡ä»¶éƒ½æ¸…æ™°åˆ†ç¦»ï¼Œä¾¿äºŽç®¡ç†
2. **æ˜“äºŽæ‰©å±•**ï¼šæœªæ¥å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„æ“ä½œç±»åž‹æˆ–é…ç½®
3. **æ˜“äºŽæŸ¥æ‰¾**ï¼šé€šè¿‡ç›®å½•å’Œæ–‡ä»¶ç»“æž„å³å¯å¿«é€Ÿå®šä½ç‰¹å®šæ“ä½œ
4. **ä¾¿äºŽç‰ˆæœ¬æŽ§åˆ¶**ï¼šæ¯ä¸ªæ–‡ä»¶ç‹¬ç«‹ï¼ŒGit diff æ›´æ¸…æ™°
5. **æ”¯æŒå¤šæ–‡ä»¶èµ„æº**ï¼šå¯ä»¥æ–¹ä¾¿åœ°æ·»åŠ ç¼©ç•¥å›¾ã€æ–‡æ¡£ç­‰èµ„æºæ–‡ä»¶
6. **æ¨¡å—åŒ–**ï¼šæ¯ä¸ªæ“ä½œæ¨¡æ¿ç‹¬ç«‹ï¼Œå¯ä»¥å•ç‹¬ä¿®æ”¹å’Œç»´æŠ¤
7. **çµæ´»æ€§**ï¼šæ¯ä¸ªæ“ä½œå¯ä»¥æœ‰è‡ªå·±çš„å‘½ä»¤æ–‡ä»¶ï¼Œäº’ä¸å¹²æ‰°
